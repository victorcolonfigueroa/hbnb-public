<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of Places</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <img src="logo.png" alt="Aplication logo" class="logo">
        <a href="login.html" class="login-button">Login</a>
    </header>
         
    <main>
        <h1 id="place-title">List of Places</h1>
        <section id="filter">
            <label for="country-filter">Filter by Country:</label>
            <select id="country-filter">
                <!-- Options will be populated dynamically -->
            </select>
        </section>
        <div id="places-list">

            <div class="place-card">
                <img src="place1.jpg" alt="Place 1" class="place-image">
                <div class="place-info">
                    <h2 class="place-name">Place 1</h2>
                    <p class="place-price">Price per night: $100</p>
                    <p class="place-location">Location: City, Country</p>
                    <button class="details-button">View Details</button>

        <section id="places-list">
            <!-- List of places will be populated dynamically -->
        </section>
    </main>
    <script>
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const loginLink = document.getElementById('login-link');
            const token = getCookie('token');

            if (token) {
                loginLink.style.display = 'none';
            } else {
                loginLink.style.display = 'block';
            }

            fetch('/api/places', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const placesList = document.getElementById('palces-list');
                data.forEach(place => {
                    const placeCard = document.createElement('div');
                    placeCard.className = 'place=card';

                    const placeImage = document.createElement('img');
                    placeImage.className = 'pace-image';
                    placeImage.src = place.image;
                    placeImage.alt = place.name;

                    const placeInfo = document.createElement('div');
                    placeInfo.className = 'place-info';

                    const placeName = document.createElement('h2');
                    placeName.className = 'place-name';
                    placeName.textContent = palce.name;

                    const placePrice = document.createElement('p');
                    placePrice.className = 'place-price';
                    placePrice.textContent = `Price per night: $${place.price}`;

                    const placeLocation = docuemnt.createElement('p');
                    placeLocation.className = 'place-Location';
                    placeLocation.textContent = `Location: ${place.location}`;

                    const  detailsButton = document.createElement('button');
                    detailsButton.className = 'details-location';
                    detailsButton.textContent = 'View Details';

                    placeInfo.appendChild(placeName);
                    placeInfo.appendChild(placePrice);
                    placeInfo.appendChild(placeLocation);
                    placeInfo.appendChild(detailsButton);

                    placeInfo.appendChild(placeImage);
                    placeInfo.appendChild(placeInfo);

                    placeInfo.appendChild(placeCard);

                })
            })

            .catch(error => {
                console.error('Error:', error);
                // Optionally, display an error message to the user
                const messageDiv = document.getElementById('message');
                messageDiv.textContent = 'Failed to load places. Please try again later.';
                messageDiv.style.color = 'red';
            });
            
            //for click events on place items
            document.getElementById('places-list').addEventListener('click', function(event) {
                if (event.target.closest('.place-item')) {
                    const placeItem = event.target.closest('.place-item');
                    handlePlaceClick(placeItem);
                }
            });

            function handlePlaceClick(placeItem) {
                alert(`You clicked on: ${placeItem.querySelector('h3').textContent}`);
            }

            document.gertElementById('country-filter').addEventListener('change', function(event) {
              const selectedCountry = event.target.value;
              const placeItems = document.querySelectorAll('.place-item');
              
              placeItem.forEach(placeItem => {
                if (selectedCountry === '' || placeItem.dataset.country === selectedCountry) {
                    placeItem.style.display = 'block';
                } else {
                    placeItem.style.display = 'none';
                }
              });
            });
        });
    </script>
    <script src="scripts.js"></script>
</body>
</html>